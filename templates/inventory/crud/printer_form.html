{% extends "base.html" %}
{% block title %}{{ title }} – Учёт картриджей{% endblock %}

{% block content %}
<h1 class="h5 mb-3">{{ title }}</h1>

<div class="card shadow-sm">
  <div class="card-body">
    <form method="post">
      {% csrf_token %}
      {{ form.media }}

      {% for field in form %}
        <div class="mb-3">
          <label class="form-label">{{ field.label }}</label>
          {{ field }}
          {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
          {% if field.errors %}<div class="text-danger small">{{ field.errors }}</div>{% endif %}
        </div>
      {% endfor %}

      {% if form.non_field_errors %}
        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
      {% endif %}

      <div class="d-flex gap-2">
        <button class="btn btn-primary" type="submit">Сохранить</button>
        <a class="btn btn-outline-secondary" href="javascript:history.back()">Отмена</a>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const building = document.querySelector('select[name="building"]');
    if (!building) return;

    building.addEventListener("change", () => {
      const url = new URL(window.location.href);

      if (building.value) url.searchParams.set("building", building.value);
      else url.searchParams.delete("building");

      // сбросить зависимые поля
      url.searchParams.delete("room");

      window.location.href = url.toString();
    });
  });
</script>
{% endblock %}